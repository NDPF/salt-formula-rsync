{% from "rsync/map.jinja" import server with context %}

uid = {{ server.user }}
gid = {{ server.group }}
log file = /var/log/rsyncd.log
pid file = /var/run/rsyncd.pid
address = {{ server.bind.address }}

{%- for name, module in server.module.iteritems() %}
[{{ name}}]
{%- if module.max_connections is defined %}
max connections = {{ module.max_connections }}
{%- endif %}
path = {{ module.path }}
read only = {{ module.get('read_only', True) }}
lock file = /var/lock/rsync_{{ name }}.lock
{%- endfor %}
